
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Model Transformers in Lightpack ORM - Lightpack Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#model-transformers-in-lightpack-orm" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Lightpack Documentation" class="md-header__button md-logo" aria-label="Lightpack Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lightpack Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Model Transformers in Lightpack ORM
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/lightpack/docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    lightpack/docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../index.md" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../introduction/" class="md-tabs__link">
        
  
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../install/" class="md-tabs__link">
        
  
  
    
  
  Installation

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../getting-started.md" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../authentication/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Lightpack Documentation" class="md-nav__button md-logo" aria-label="Lightpack Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Lightpack Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lightpack/docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    lightpack/docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Relationships
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../orm-introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ORM Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../..." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    None
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="model-transformers-in-lightpack-orm">Model Transformers in Lightpack ORM<a class="headerlink" href="#model-transformers-in-lightpack-orm" title="Permanent link">&para;</a></h1>
<p>Model transformers are a powerful feature in Lightpack ORM, designed to help you convert your models (and collections of models) into clean, structured arrays for API responses, view rendering, or any custom output. They empower you to:
- Select and filter fields dynamically
- Include and nest related models
- Transform collections and paginated data
- Support multiple output contexts (e.g., API, view)
- Keep presentation logic out of your models</p>
<hr />
<h2 id="what-is-a-transformer">What is a Transformer?<a class="headerlink" href="#what-is-a-transformer" title="Permanent link">&para;</a></h2>
<p>A transformer is a dedicated class that defines how a model (or collection of models) should be represented as an array. Transformers encapsulate field selection, relation inclusion, and output formatting logic.</p>
<p><strong>Why use transformers?</strong>
- Centralize and DRY up your serialization logic
- Enforce consistent API and view output
- Support dynamic field selection and relation includes
- Easily adapt output for different consumers (API, admin, etc.)</p>
<hr />
<h2 id="how-transformer-resolution-works">How Transformer Resolution Works<a class="headerlink" href="#how-transformer-resolution-works" title="Permanent link">&para;</a></h2>
<p>Transformers in Lightpack ORM are designed to make your API and view output flexible, maintainable, and secure. Understanding how the framework selects and applies transformers is key to leveraging their full power.</p>
<h3 id="resolution-process">Resolution Process<a class="headerlink" href="#resolution-process" title="Permanent link">&para;</a></h3>
<p>When you call the <code>transform()</code> method on a model (or collection), Lightpack follows a clear, predictable process:</p>
<ol>
<li><strong>Check the <code>$transformer</code> Property</strong></li>
<li>This property tells Lightpack which transformer class to use.</li>
<li>
<p>It can be:</p>
<ul>
<li>A <strong>string</strong>: The class name of a single transformer (e.g., <code>UserTransformer::class</code>).</li>
<li>An <strong>array</strong>: A map of context names (like <code>'api'</code>, <code>'view'</code>) to transformer classes.</li>
<li><code>null</code>: No transformer defined—calling <code>transform()</code> will throw an error.</li>
</ul>
</li>
<li>
<p><strong>Context Support</strong></p>
</li>
<li>If you want different outputs for different consumers (API, admin, etc.), use an array mapping contexts to transformer classes.</li>
<li>
<p>At runtime, specify the context via the <code>context</code> option:
   <code>php
   $product-&gt;transform(['context' =&gt; 'api']);
   $product-&gt;transform(['context' =&gt; 'view']);</code></p>
</li>
<li>
<p><strong>Fields and Includes</strong></p>
</li>
<li>You can pass a <code>fields</code> array to include only specific fields for the main model or for related models.</li>
<li>You can pass an <code>includes</code> array to include related data (including nested relations).</li>
<li>These options are forwarded directly to the transformer instance before transformation.
   <code>php
   $user-&gt;transform([
       'fields' =&gt; ['self' =&gt; ['name', 'email']],
       'includes' =&gt; ['profile', 'roles'],
   ]);</code></li>
</ol>
<h2 id="defining-a-transformer">Defining a Transformer<a class="headerlink" href="#defining-a-transformer" title="Permanent link">&para;</a></h2>
<hr />
<p>The <code>transform()</code> method on any model is the canonical way to convert it to an array for API or view output. This method:</p>
<ul>
<li>Looks up the transformer class from the model’s <code>$transformer</code> property.</li>
<li>If <code>$transformer</code> is a string, it instantiates that transformer.</li>
<li>If <code>$transformer</code> is an array, it expects a <code>context</code> key in the options array (e.g., <code>'api'</code>, <code>'view'</code>) and selects the transformer for that context.</li>
<li>If no transformer is defined, or the context is invalid, it throws a clear, descriptive exception.</li>
</ul>
<h3 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h3>
<pre><code class="language-php">// Single transformer
class User extends Model {
    protected $transformer = UserTransformer::class;
}

// Multiple contexts
class Product extends Model {
    protected $transformer = [
        'api' =&gt; ProductApiTransformer::class,
        'view' =&gt; ProductViewTransformer::class,
    ];
}

// Usage
$user = new User(1);
$userArray = $user-&gt;transform(); // Uses UserTransformer

$product = new Product(1);
$productApi = $product-&gt;transform(['context' =&gt; 'api']);
$productView = $product-&gt;transform(['context' =&gt; 'view']);
</code></pre>
<h4 id="passing-fields-and-includes">Passing Fields and Includes<a class="headerlink" href="#passing-fields-and-includes" title="Permanent link">&para;</a></h4>
<p>You can pass <code>fields</code> and <code>includes</code> options to control the output:</p>
<pre><code class="language-php">$user-&gt;transform([
    'fields' =&gt; ['self' =&gt; ['name', 'email']],
    'includes' =&gt; ['profile', 'roles'],
]);
</code></pre>
<p>These options are forwarded to the transformer instance and determine which fields and relations are included in the output.</p>
<hr />
<p>A transformer is a PHP class that extends <code>Lightpack\Database\Lucid\Transformer</code> and implements a <code>data($model)</code> method. This method returns an array representation of the model, controlling which fields are exposed and how relations are included.</p>
<h3 id="basic-transformer-example">Basic Transformer Example<a class="headerlink" href="#basic-transformer-example" title="Permanent link">&para;</a></h3>
<pre><code class="language-php">use Lightpack\Database\Lucid\Transformer;

class ProjectTransformer extends Transformer
{
    protected function data($model): array
    {
        return [
            'id' =&gt; $model-&gt;id,
            'name' =&gt; $model-&gt;name,
        ];
    }
}
</code></pre>
<h3 id="using-fields-and-includes-in-transformers">Using Fields and Includes in Transformers<a class="headerlink" href="#using-fields-and-includes-in-transformers" title="Permanent link">&para;</a></h3>
<p>You don't have to manually filter fields or include relations in your <code>data()</code> method—Lightpack handles this based on the <code>fields()</code> and <code>includes()</code> options passed at runtime. Your <code>data()</code> method should return the full set of possible fields for the model.</p>
<h3 id="contextual-transformers">Contextual Transformers<a class="headerlink" href="#contextual-transformers" title="Permanent link">&para;</a></h3>
<p>You can define multiple transformers for the same model to support different output contexts (e.g., API, view, admin):</p>
<pre><code class="language-php">class ProductApiTransformer extends Transformer
{
    protected function data($model): array
    {
        return [
            'name' =&gt; $model-&gt;name,
            'price' =&gt; $model-&gt;price,
        ];
    }
}

class ProductViewTransformer extends Transformer
{
    protected function data($model): array
    {
        return [
            'id' =&gt; $model-&gt;id,
            'name' =&gt; $model-&gt;name,
            'price' =&gt; $model-&gt;price,
            'color' =&gt; $model-&gt;color,
        ];
    }
}
</code></pre>
<h3 id="associating-transformers-with-models">Associating Transformers with Models<a class="headerlink" href="#associating-transformers-with-models" title="Permanent link">&para;</a></h3>
<p>To use a default transformer, set the <code>$transformer</code> property on your model:</p>
<pre><code class="language-php">class Project extends Model
{
    protected $table = 'projects';
    protected $transformer = ProjectTransformer::class;
}
</code></pre>
<p>To support multiple contexts, use an array mapping context names to transformer classes:</p>
<pre><code class="language-php">class Product extends Model
{
    protected $transformer = [
        'api' =&gt; ProductApiTransformer::class,
        'view' =&gt; ProductViewTransformer::class,
    ];
}
</code></pre>
<p>When transforming, specify the context:</p>
<pre><code class="language-php">$product-&gt;transform(['context' =&gt; 'api']); // Uses ProductApiTransformer
$product-&gt;transform(['context' =&gt; 'view']); // Uses ProductViewTransformer
</code></pre>
<p>If an invalid context is provided, Lightpack will throw a descriptive exception listing available contexts.</p>
<hr />
<h2 id="basic-usage">Basic Usage<a class="headerlink" href="#basic-usage" title="Permanent link">&para;</a></h2>
<h3 id="transforming-a-single-model">Transforming a Single Model<a class="headerlink" href="#transforming-a-single-model" title="Permanent link">&para;</a></h3>
<pre><code class="language-php">$project = new Project(1);
$transformer = new ProjectTransformer();

$result = $transformer-&gt;transform($project);
// [ 'id' =&gt; 1, 'name' =&gt; 'Project 1' ]
</code></pre>
<h3 id="field-selection">Field Selection<a class="headerlink" href="#field-selection" title="Permanent link">&para;</a></h3>
<p>Select only specific fields for the main model ("self") or for relations:</p>
<pre><code class="language-php">$result = $transformer
    -&gt;fields(['self' =&gt; ['name']])
    -&gt;transform($project);
// [ 'name' =&gt; 'Project 1' ]
</code></pre>
<h3 id="including-relations">Including Relations<a class="headerlink" href="#including-relations" title="Permanent link">&para;</a></h3>
<p>Include related models by name:</p>
<pre><code class="language-php">$result = $transformer
    -&gt;includes('tasks')
    -&gt;fields([
        'self' =&gt; ['name'],
        'tasks' =&gt; ['id', 'name'],
    ])
    -&gt;transform($project);
// [ 'name' =&gt; 'Project 1', 'tasks' =&gt; [ [ 'id' =&gt; 1, 'name' =&gt; 'Task 1' ] ] ]
</code></pre>
<hr />
<h2 id="nested-relations-deep-includes">Nested Relations &amp; Deep Includes<a class="headerlink" href="#nested-relations-deep-includes" title="Permanent link">&para;</a></h2>
<p>You can include nested relations using dot notation:</p>
<pre><code class="language-php">$result = $transformer
    -&gt;includes('tasks.comments')
    -&gt;fields([
        'self' =&gt; ['name'],
        'tasks' =&gt; ['name'],
        'tasks.comments' =&gt; ['content']
    ])
    -&gt;transform($project);
// [ 'name' =&gt; 'Project 1', 'tasks' =&gt; [ [ 'name' =&gt; 'Task 1', 'comments' =&gt; [ [ 'content' =&gt; 'Comment 1' ] ] ] ] ]
</code></pre>
<p>You can also include multiple paths at once:</p>
<pre><code class="language-php">$result = $transformer
    -&gt;includes(['tasks', 'tasks.comments'])
    -&gt;fields([
        'self' =&gt; ['id', 'name'],
        'tasks' =&gt; ['name'],
        'tasks.comments' =&gt; ['content']
    ])
    -&gt;transform($project);
</code></pre>
<hr />
<h2 id="handling-missing-or-null-relations">Handling Missing or Null Relations<a class="headerlink" href="#handling-missing-or-null-relations" title="Permanent link">&para;</a></h2>
<ul>
<li>If a relation is missing or not included, it is omitted from the output.</li>
<li>If a relation is included but null or empty, it appears as an empty array or null, as appropriate.</li>
</ul>
<hr />
<h2 id="transforming-collections">Transforming Collections<a class="headerlink" href="#transforming-collections" title="Permanent link">&para;</a></h2>
<p>Transformers can handle collections of models seamlessly:</p>
<pre><code class="language-php">$projects = Project::query()-&gt;all();
$result = $transformer
    -&gt;includes(['tasks'])
    -&gt;fields([
        'self' =&gt; ['name'],
        'tasks' =&gt; ['name']
    ])
    -&gt;transform($projects);
// [ [ 'name' =&gt; 'Project 1', 'tasks' =&gt; [ ... ] ], ... ]
</code></pre>
<hr />
<h2 id="model-integrated-transformation">Model-integrated Transformation<a class="headerlink" href="#model-integrated-transformation" title="Permanent link">&para;</a></h2>
<p>You can call <code>transform()</code> directly on a model or collection, passing options:</p>
<pre><code class="language-php">$result = $project-&gt;transform([
    'includes' =&gt; ['tasks.comments'],
    'fields' =&gt; [
        'self' =&gt; ['name'],
        'tasks' =&gt; ['name'],
        'tasks.comments' =&gt; ['content'],
    ],
]);
</code></pre>
<hr />
<h2 id="pagination-support">Pagination Support<a class="headerlink" href="#pagination-support" title="Permanent link">&para;</a></h2>
<p>If you have a paginated collection, you can transform it for API output:</p>
<pre><code class="language-php">$pagination = new Pagination($projects, $total, $perPage, $currentPage);
$result = $pagination-&gt;transform([
    'includes' =&gt; ['tasks'],
    'fields' =&gt; [
        'self' =&gt; ['name'],
        'tasks' =&gt; ['name'],
    ],
]);
// Output includes 'data', 'meta', and 'links' keys
</code></pre>
<hr />
<h2 id="dynamic-includes-comma-and-dot-notation">Dynamic Includes: Comma and Dot Notation<a class="headerlink" href="#dynamic-includes-comma-and-dot-notation" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Comma notation</strong>: Direct relations (<code>includes(['tasks', 'comments'])</code>)—relations are included at the top level.</li>
<li><strong>Dot notation</strong>: Nested relations (<code>includes('tasks.comments')</code>)—relations are nested under their parent.</li>
</ul>
<p>You can mix and match as needed.</p>
<hr />
<h2 id="contextual-transformers_1">Contextual Transformers<a class="headerlink" href="#contextual-transformers_1" title="Permanent link">&para;</a></h2>
<p>Transformers can support multiple output contexts (e.g., API, view) for the same model:</p>
<pre><code class="language-php">$product = new Product(1);

// API context
$result = $product-&gt;transform(['context' =&gt; 'api']);
// Uses ProductApiTransformer

// View context
$result = $product-&gt;transform(['context' =&gt; 'view']);
// Uses ProductViewTransformer
</code></pre>
<p>If an invalid context is provided, a clear exception is thrown listing available contexts.</p>
<hr />
<h2 id="error-handling-robustness">Error Handling &amp; Robustness<a class="headerlink" href="#error-handling-robustness" title="Permanent link">&para;</a></h2>
<ul>
<li>If you include a non-existent relation, it is simply ignored in the output.</li>
<li>If you call <code>transform()</code> on a model without a transformer, you get a clear exception: <code>No transformer defined for model: ModelClass</code>.</li>
<li>If you specify an invalid context, a descriptive exception is thrown: <code>Invalid transformer context 'admin' for ModelClass. Available contexts: api, view</code>.</li>
<li>Null or missing relations are output as empty arrays or omitted, never causing errors.</li>
</ul>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>